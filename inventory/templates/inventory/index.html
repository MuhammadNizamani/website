{% extends 'base.html' %}
{% load staticfiles %}


{% block header %}
    <link rel="stylesheet" type="text/css" href="{% static "inventory/css/style.css" %}">
{% endblock header %}

<!-- TODO sette link til inventory i headeren? -->

{% block content %}
    <!-- For å vise eventuelle meldinger fra oppretting/endring av item eller tag. -->
    {% if messages %}
        {% for message in messages %}
            <script>
                var $toastContent = $('<span>{{ message }}</span>');
                Materialize.toast($toastContent, 5000);
                <!-- TODO sette delay på disse hvis man har flere meldinger-->
            </script>
        {% endfor %}
    {% endif %}

    <div class="content">
        <!-- TODO flytt dette søkefeltet og knappen til riktig sted -->
        <br>
        <form id="searchform" action="{% url 'inventory:search' %}" method="get">
            {% csrf_token %}
            <input class="searchfield" id="searchbox" name="q" type="text" placeholder="Søk" autocomplete="off">
            <button class="btn waves-effect waves-light" type="submit" name="action">søk</button>
        </form>

        <h1>Inventar</h1>

        {% if request.user.is_authenticated %}
            {% if perms.inventory.add_item %}
                <a href="{% url 'inventory:add_item' %}" class="waves-effect waves-light btn">Legg til gjenstand</a>
            {% endif %}
            {% if perms.inventory.add_tag %}
                <a href="{% url 'inventory:add_tag' %}" class="waves-effect waves-light btn">Legg til tag</a>
            {% endif %}
            {% if perms.inventory.add_loan %}
                <a href="{% url 'inventory:register_loan' %}" class="waves-effect waves-light btn">Registrer utlån</a>
                <a href="{% url 'inventory:administrate_loans' %}" class="waves-effect waves-light btn">Administrer
                    utlån</a>
            {% endif %}
            <a href="{% url 'inventory:my_loans' %}" class="waves-effect waves-light btn">Mine lån</a>
        {% endif %}


        <!-- TODO knapper man ikke kan bruke med mindre man er logget inn, kan enten linke til innloggingsside, eller
        være gråe, og ikke fungerende
        TODO endre fra "category" til "tag", for å være konsekvent
        -->
        <ul class="collapsible" data-collapsible="accordion">
            <!-- collapsible sorted by cateogry, items sorted alphabetically -->
            {% for category, items in item_dict.items %}
                <li>
                    <div class="collapsible-header">{{ category }}</div>
                    <div class="collapsible-body">
                        <ul>
                            <br>
                            {% for item in items %}
                                <li>
                                    <a href={% url 'inventory:detail' item.id %}>{{ item.name }}</a>
                                </li>
                            {% endfor %}
                            <br>
                            <li>
                                <a href="{% url 'inventory:tag_detail' category.id %}">Til kategoriside</a>
                            </li>
                            <br>
                        </ul>
                    </div>

                </li>
            {% endfor %}

            <!-- shows items without category -->

            <!-- TODO lag bakgrunn i collaipsible -->
            {% if no_category %}
                <li>
                    <div class="collapsible-header"><i class="material-icons"> </i>Ingen tag</div>
                    <div class="collapsible-body">
                        <ul>
                            <br>
                            {% for item in no_category %}
                                <li>
                                    <a href={% url 'inventory:detail' item.id %}>{{ item.name }}</a>
                                </li>
                            {% endfor %}
                            <br>
                        </ul>
                    </div>

                </li>
            {% endif %}
        </ul>

    </div>
{% endblock content %}
