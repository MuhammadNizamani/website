{% extends 'website/base.html' %}

{% block head %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.0/fullcalendar.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.0/fullcalendar.min.js"></script>
{% endblock %}

{% block content %}

    <div class="section block">
        <div class="row">
            <div class="col s10 offset-s1">
                <div id='calendar'></div>
            </div>
        </div>
    </div>

    <div id="reservation_modal" class="modal">
        <form action="{% url 'reservations:queue_detail' pk=queue.pk %}" method="POST">
            {% csrf_token %}
            <div class="modal-content">
                {{ form.as_p }}
            </div>
            <div class="modal-footer">
                <input type="submit" value="send">
            </div>
        </form>
    </div>

    <script>

        $(document).ready(function () {
            $('#reservation_modal').modal({
                startingTop: '30%',
                endingTop: '50%',
            });
        });

        $(function () {

            $('#calendar').fullCalendar({

                selectable: true,
                height: 500,
                defaultView: 'agendaWeek',
                allDaySlot: false,
                firstDay: 1,
                header: {right: 'prev, next'},
                refetchResourcesOnNavigate: true,
                slotDuration: '00:30:00',
                snapDuration: '00:05:00',
                slotLabelInterval: {hours: 1},

                slotLabelFormat: "HH:mm",
                scrollTime: '10:00:00', // calendar will init scroll position to interval 10:00-18:00

                {% if request.user is member %}
                    minTime: "00:00:00",
                    maxTime: "23:59:59",
                {% else %}
                    // minTime: "10:00:00",
                    // maxTime: "18:00:00",
                {% endif %}

                events: {
                    url: '{% url 'reservations:reservation_api' pk=queue.pk %}',
                    type: 'GET',
                    error: function () {
                        console.log("error!");
                    },
                    success: function (data) {
                        console.log(data);
                    },
                },

                select: function (startDate, endDate) {
                    let modal = $('#reservation_modal')
                    let instance = M.Modal.getInstance(modal);
                    $('#id_start')[0].value = startDate.format();
                    $('#id_end')[0].value = endDate.format();
                    $('#id_parent_queue')[0].value = {{ queue.pk }};
                    instance.open();
                },
                eventMouseover: function(mouseEnterInfo){
                    console.log(mouseEnterInfo);
                }
            })


        });

        function makeReservation() {

        }
    </script>

{% endblock content %}
