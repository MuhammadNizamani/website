{% extends 'website/base.html' %}
{% load staticfiles %}
{% load picker_modal %}
{% load modal_upload %}


{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
<script src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>
<script src="{% static 'ckeditor/ckeditor-init.js' %}"></script>
{% endblock head %}

{% block content %}
<div class="section block hs-green white-text">
	<div class="container">
		<div class="row">
			<div class="col s12">
				<h4>Rediger artikkel</h4>
			</div>
		</div>
	</div>
</div>
<div class="section block">
	<div class="container">
		<div class="card-panel">
			<div class="row">
				<form action="" method="post" novalidate>
					<div class="col s12">
						<h5>Innhold</h5>
						<div class="divider"></div>
						<br>
					</div>
					{% csrf_token %}
					<div class="input-field col s12">
						{{ form.title }}
						<label for="{{ form.title.id_for_label }}">{{ form.title.label }}</label>
						<span class="helper-text hs-red-text">{{ form.title.errors }}</span>
					</div>
					<div class="input-field col s12">
						{{ form.ingress_content }}
						<label for="id_ingress_content">{{ form.ingress_content.label }}</label>
						<span class="helper-text hs-red-text">{{ form.ingress_content.errors }}</span>
					</div>

					<div class="input-field col s12">
						<p>{{ form.main_content.label }}</p>
						<span class="helper-text hs-red-text">{{ form.main_content.errors }}</span>
						{{ form.main_content }}
					</div>
					<div class="col s12 input-field">
						<div class="col s12">
							<p>
							<label>
								{{ form.internal }}
								<span for="internal-check">{{ form.internal.label }}</span>
							</label>
							</p>
							<span class="helper-text hs-red-text">{{ form.internal.errors }}</span>
						</div>
					</div>
					<div class="col s12">
						<div class="input-field">
							<input id="{{ form.thumbnail.id_for_label }}" name="thumbnail" type="hidden" value="{{ form.thumbnail.value }}">
						</div>
						<input id="fileInput" type="hidden">
						<div id="thumbnailPicker" class="modal">
							<div class="modal-content">
								{% ImagePickModal request %}
							</div>
						</div>
						<a class="modal-trigger waves-effect waves-light btn btn-large hs-green" data-target="uploadModal">Last opp nytt bilde</a>
						<a class="modal-trigger waves-effect hs-green white-text waves-light btn btn-large" data-target="thumbnailPicker">Vis bildegalleri</a>
						<span class="helper-text hs-red-text">{{ form.thumbnail.errors }}</span>

						{% if form.thumbnail.value %}
						<div id="thumb-preview" class="card small thumb-preview" style="background-image: url('/files/image/{{ form.thumbnail.value }}/view); background-repeat:no-repeat; background-size: cover;">
						{% else %}
						<div id="thumb-preview" class="card small thumb-preview" style="background-image: none; background-repeat:no-repeat; background-size:cover;">
						{% endif %}
							</div>
							<div>
								<button id="submit" class="btn btn-large hs-green waves-effect waves-light" type="submit" name="action">Lagre og publiser artikkel</button>
				</form>
				{% UploadModal request %}
							</div>
						</div>
					</div>
			</div>
		</div>
	</div>
</div>
<script>
var thumbModal = document.querySelector('#thumbnailPicker');
var instance = M.Modal.init(thumbModal);

var thumbnail_input = document.querySelector('#id_thumbnail');
var thumb_preview = document.querySelector('#thumb-preview');

document.addEventListener('click', function(e) {
	if(e.target.innerText == "SELECT") {
		var selectedImgId = e.target.attributes.value.value;
		thumbnail_input.value = selectedImgId;
		thumb_preview.style.backgroundImage = "url('/files/image/" + selectedImgId + "/view')";
		M.toast({html: 'Bilde er valgt.'});
		M.Modal.getInstance(thumbModal).close();
	}
});
</script>
{% endblock content %}
