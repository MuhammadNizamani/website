{% extends 'base.html' %}
{% load staticfiles %}

{% block head %}
  <link rel="stylesheet" type="text/css" href="{% static "css/news.css" %}">
  <link rel="stylesheet" type="text/css" href="{% static "css/event.css" %}">
{% endblock head %}

{% block content %}
<div id="spacer" style="height: 100px;"></div>

<div id="content">
  <div class="image-container">
    <img class="news-image" src="{{ event.thumbnail.url }}">
  </div>
  <h1 class="truncate">{{ event.title }}</h1>

  <hr class="news-hr">
  <div id="sidepanel">
    {% if event.place %}
      <div>
        <p class="infoheader">Sted:</p><a class="info" href="{{ event.place_href }}" target="_blank">{{ event.place }}</a>
      </div>
    {% endif %}
    <div>
      <p class="infoheader">Tid:</p><p class="info">{{ event.time_start|date:"H:i" }} - {{ event.time_end|date:"H:i" }}</p>
    </div>
    <div>
      <p class="infoheader">Dato:</p><p class="info">{{ event.time_start|date:"d M Y" }}</p>
    </div>
    {% if event.registration %}
    <p class="infoheader">Status:</p><p class="info">{{ userstatus }}</p>
      <div class="registration" style="text-align: center">
        <div class="progress">
          <div class="determinate" style="width: {{ event.registered_percentage }}%"></div>
          <p class="counter">{{ event.registered_count }} / {{ event.max_limit }}</p>
        </div>
        {% if event.registration and request.user.is_authenticated and registration_visible %}
          <form method="post" action="/news/register/{{ event.id }}/">
            {% csrf_token %}
            {% if registered %}
              <button id="submit" class="btn waves-effect waves-light hsred" type="submit" name="action">Meld deg av</button>
            {% else %}
              <button id="submit" class="btn waves-effect waves-light hsgreen" type="submit" name="action">Meld deg på</button>
            {% endif %}
          </form>
        {% endif %}
      </div>
      <div class="registered_users">
        <ul class="collapsible" data-collapsible="accordion">
          {% if event.registered_list %}
            <li>
              <div class="collapsible-header">Påmeldte</div>
              <div class="collapsible-body people">
                {% for user in event.registered_list %}
                  <p>{{ user }}</p>
                {% endfor %}
              </div>
            </li>
          {% endif %}
          {% if event.wait_list %}
            <li>
              <div class="collapsible-header">Venteliste</div>
              <div class="collapsible-body people">
                {% for user in event.wait_list %}
                  <p>{{ user }}</p>
                {% endfor %}
              </div>
            </li>
          {% endif %}
        </ul>
        <script>
          $(function(){
           $('.collapsible').collapsible();
         });
        </script>
      </div>
    {% endif %}
  </div>

  <div id="main_content">
    {% autoescape off %}
    {{ event.ingress_content }}
    {% endautoescape %}

    {% autoescape off %}
    {{ event.main_content }}
    {% endautoescape %}
  </div>

</div>
{% endblock content %}
