{% extends 'base.html' %}
{% load staticfiles %}
{% load check_user_group %}

{% block head %}
  <link rel="stylesheet" type="text/css" href="{% static "css/edit_news.css" %}">
  <link rel="stylesheet" type="text/css" href="{% static "css/lolliclocks.css" %}">
  <script src="{% static "js/lolliclocks.js" %}"></script>
  <script type="text/javascript" src="{% static "ckeditor/ckeditor/ckeditor.js" %}"></script>
  <script type="text/javascript" src="{% static "ckeditor/ckeditor-init.js" %}"></script>
{% endblock head %}

{% block content %}
  {% if request.user|has_group:"member" %}
    <div id="edit">
      <h2>Rediger event</h2>
      <form action="" method="post" style="width: 835px;">
        {% csrf_token %}

        {{ form.title.errors }}
        <div class="input-field">
          <label for="{{ form.title.id_for_label }}">{{ form.title.label }}</label>
          {{ form.title }}
        </div>

        {{ form.ingress_content.errors }}
        <label>{{ form.ingress_content.label }}</label>
        {{ form.ingress_content }}

        {{ form.main_content.errors }}
        <label>{{ form.main_content.label }}</label>
        {{ form.main_content }}

        {{ form.registration.errors }}
        <div class="input-field">
          <input type="checkbox" class="filled-in" id="filled-in-box" name="registration" value="{{ form.registration.value }}"/>
          <label for="filled-in-box">{{ form.registration.label }}</label>
        </div>
        <br>

        {{ form.max_limit.errors }}
        <div class="input-field">
          <label for="{{ form.max_limit.id_for_label }}">{{ form.max_limit.label }}</label>
          {{ form.max_limit }}
        </div>

        {{ form.place.errors }}
        <div class="input-field">
          <label for="{{ form.place.id_for_label }}">{{ form.place.label }}</label>
          {{ form.place }}
        </div>

        {{ form.place_href.errors }}
        <div class="input-field">
          <label for="{{ form.place_href.id_for_label }}">{{ form.place_href.label }}</label>
          {{ form.place_href }}
        </div>

        {{ form.date.errors }}
        <div class="input-field">
          <label for="{{ form.date.id_for_label }}">{{ form.date.label }}</label>
          <input id="{{ form.date.id_for_label }}" class="datepicker" name="date" type="date"
                 value="{{ form.date.value }}">
        </div>

        {{ form.time_start.errors }}
        <div class="input-field">
          <label for="{{ form.time_start.id_for_label }}">{{ form.time_start.label }}</label>
          {{ form.time_start }}
        </div>

        {{ form.time_end.errors }}
        <div class="input-field">
          <label for="{{ form.time_end.id_for_label }}">{{ form.time_end.label }}</label>
          {{ form.time_end }}
        </div>

        <div style="display: none;">
          {{ form.thumbnail.errors }}
          <div class="input-field">
            <label for="{{ form.thumbnail.id_for_label }}">Thumbnail</label>
            <input id="{{ form.thumbnail.id_for_label }}" name="thumbnail" type="text" value="{{ form.thumbnail.value }}">
          </div>
        </div>

        <label>Thumbnail</label><br>
        <div class="imageItem card thumbnailPicker">
          <div class="card-image" style="background-image: url(/files/image/{{ form.thumbnail.value }}/view);"></div>
        </div>

        <script>
          $(".thumbnailPicker").click(function() {
              thumbWindow = window.open('/files/images');
          });

          function selectThumnail(src, id) {
              thumbWindow.close();
              $("input[name^=thumbnail]").val(id);
              $(".thumbnailPicker").find("div").css("background-image", "url("+src+")");
              console.log(src, id);
          }
        </script>

        <script>
          $('.datepicker').pickadate({
            selectMonths: true, // Creates a dropdown to control month
            selectYears: 15 // Creates a dropdown of 15 years to control year
          });
          $('#{{ form.time_start.id_for_label }}').lolliclock({autoclose: true, hour24: true});
          $('#{{ form.time_end.id_for_label }}').lolliclock({autoclose: true, hour24: true});

          $(function () {
            if ($("#filled-in-box").prop("value") == "True") {
              $("#filled-in-box").prop("checked", true);
            }
          });
          $("#filled-in-box").change(function() {
            if ($("#filled-in-box").prop("value") == "True") {
              $("#filled-in-box").val("False");

            } else {
              $("#filled-in-box").val("True");
            }
          });

        </script>
        <script type="text/javascript" src="{% static "js/thumbnail_picker.js" %}"></script>

        <button id="submit" class="btn waves-effect waves-light" type="submit" name="action">Lagre</button>
      </form>
    </div>
  {% endif %}
{% endblock content %}
