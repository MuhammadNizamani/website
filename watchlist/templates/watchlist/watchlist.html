
{% extends 'website/base.html' %}

{% load static %}

{% block head %}
<title> Vaktliste </title>
<link rel="stylesheet" href="{% static "watchlist/css/watchlist.css" %}">
<script src="{% static "watchlist/js/calendarManager.js" %}" defer></script>
{% endblock %}

{% block content %}
<div class="section hs-green white-text">
    <div class="container">
        <div class="row">
            <div class="col s12">
                <h4>Vaktliste</h4>
                <p>Vaktlisten gir en oversikt over når verkstedet er åpent og bemannet, og hva slags kompetanse de vakthavende har.</p>
            </div>
        </div>
    </div>
</div>

<div class="section">
    <div class="container">
        <div class="row">
            <!-- Tablet and desktop get full tables -->
            <div class="col m12 hide-on-small-only">
                <table class="striped watchlist">
                    <thead>
                        <tr class="watchlist-row watchlist-header-row">
                            <th>Tid</th>
                            {% for day in columns %}
                            <th>{{ day }}</th>
                            {% endfor %}
                        </tr>
                    </thead>

                    <tbody>
                        {% for time, shifts in rows.items %}
                        <tr class="watchlist-row">
                            <td class="watchlist-cell watchlist-time">{{ time|linebreaksbr }}</td>
                            {% for shift in shifts %}
                            <td class="watchlist-cell watchlist-slot">
                                <div class="watchlist-cell-content">
                                    <div class="watchlist-tag white-text {% if shift.watchers.count == 0 %}watchlist-closed{% else %}watchlist-open{% endif %}">
                                        {% if shift.watchers.count == 0 %}
                                        <i class="material-icons">block</i>
                                        {% elif shift.watchers.count == 1 %}
                                        <i class="material-icons">person</i>
                                        {% elif shift.watchers.count == 2 %}
                                        <i class="material-icons">group</i>
                                        {% else %}
                                        <i class="material-icons">group_add</i>
                                        {% endif %}
                                    </div>

                                    <div class="watchlist-skills">
                                        {% for category, data in shift.get_shift_skills.items %}
                                        <div class="skill-icon white-text hs-green" style="background-color:{{data.color}} !important;">
                                            <span>{{ data.level }}</span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Mobile gets one table per day -->
            <div class="col s12 hide-on-med-and-up">
                {% for day in columns %}
                <table>
                    <thead>
                        <tr class="watchlist-row watchlist-header-row">
                            <th>Tid</th>
                            <th>{{ day }}</th>
                        </tr>
                    </thead>
                    

                    <tbody>
                        {% for time, shifts in rows.items %}
                        <tr class="watchlist-row">
                            <td class="watchlist-cell watchlist-time">{{ time|linebreaksbr }}</td>
                            {% for shift in shifts %}
                            <!-- Bare vis skift fra dagen som denne tabellen tilhører til -->
                            {% if forloop.parentloop.parentloop.counter0 ==  shift.weekday %}
                            <td class="watchlist-cell watchlist-slot">
                                <div class="watchlist-cell-content">
                                    <div class="watchlist-tag white-text {% if shift.watchers.count == 0 %}watchlist-closed{% else %}watchlist-open{% endif %}">
                                        {% if shift.watchers.count == 0 %}
                                        <i class="material-icons">block</i>
                                        {% elif shift.watchers.count == 1 %}
                                        <i class="material-icons">person</i>
                                        {% elif shift.watchers.count == 2 %}
                                        <i class="material-icons">group</i>
                                        {% else %}
                                        <i class="material-icons">group_add</i>
                                        {% endif %}
                                    </div>

                                    <div class="watchlist-skills">
                                        {% for category, data in shift.get_shift_skills.items %}
                                        <div class="skill-icon white-text hs-green" style="background-color:{{data.color}} !important;">
                                            <span>{{ data.level }}</span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </td>
                            {% endif %}
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Tegnforklaring -->
<div class="section hs-gray white-text">
    <div class="container">
        <div class="row">
            <div class="col s12">
                <h4>Tegnforklaring</h4>
                <div class="row">
                    <div class="legend-symbol col s12 m6 l3">
                        <div class="watchlist-tag watchlist-closed">
                            <i class="material-icons">block</i>
                        </div>
                        <p>
                            Verkstedet er <b>stengt</b><br>
                            Ingen på vakt
                        </p>
                    </div>
                    <div class="legend-symbol col s12 m6 l3">
                        <div class="watchlist-tag watchlist-open">
                            <i class="material-icons">person</i>
                        </div>
                        <p>
                            Verkstedet er <b>åpent</b><br>
                            1 person på vakt
                        </p>
                    </div>
                    <div class="legend-symbol col s12 m6 l3">
                        <div class="watchlist-tag watchlist-open">
                            <i class="material-icons">group</i>
                        </div>
                        <p>
                            Verkstedet er <b>åpent</b><br>
                            2 personer på vakt
                        </p>
                    </div>
                    <div class="legend-symbol col s12 m6 l3">
                        <div class="watchlist-tag watchlist-open">
                            <i class="material-icons">group_add</i>
                        </div>
                        <p>
                            Verkstedet er <b>åpent</b><br>
                            3+ personer på vakt
                        </p>
                    </div>
                </div>
                <hr/>
                <div class="row">
                    {% for category in skill_categories %}
                    <div class="legend-symbol col s12 m6 l3">
                        <div class="watchlist-tag" style="background-color:{{category.color}} !important;"></div>
                        <p>{{ category }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
