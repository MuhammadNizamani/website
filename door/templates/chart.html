{% load staticfiles %}
{% include 'base.html' %}
<div style="width: 1200px; margin: 200px auto; margin-bottom: 100px;">
    <div id="chart_div"></div>
</div>
{% include 'footer.html' %}

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>
    google.charts.load('current', {packages: ['corechart', 'line']});
    google.charts.setOnLoadCallback(drawBasic);

    function drawBasic() {

        var data = new google.visualization.DataTable();
        data.addColumn('datetime', 'Time');
        data.addColumn('number', 'Door');

        data.addRows([
          {% for entry in data %}
              [new Date({{ entry.opened|date:"Y" }}, {{ entry.opened|date:"m" }}, {{ entry.opened|date:"d" }}, {{ entry.opened|time:"H" }}, {{ entry.opened|time:"i" }}, {{ entry.opened|time:"s" }}), 0],
              [new Date({{ entry.opened|date:"Y" }}, {{ entry.opened|date:"m" }}, {{ entry.opened|date:"d" }}, {{ entry.opened|time:"H" }}, {{ entry.opened|time:"i" }}, {{ entry.opened|time:"s" }}), 1],
              [new Date({{ entry.closed|date:"Y" }}, {{ entry.closed|date:"m" }}, {{ entry.closed|date:"d" }}, {{ entry.closed|time:"H" }}, {{ entry.closed|time:"i" }}, {{ entry.closed|time:"s" }}), 1],
              [new Date({{ entry.closed|date:"Y" }}, {{ entry.closed|date:"m" }}, {{ entry.closed|date:"d" }}, {{ entry.closed|time:"H" }}, {{ entry.closed|time:"i" }}, {{ entry.closed|time:"s" }}), 0],
          {% endfor %}
          {% if status.status %}
              [new Date({{ status.datetime|date:"Y" }}, {{ status.datetime|date:"m" }}, {{ status.datetime|date:"d" }}, {{ status.datetime|time:"H" }}, {{ status.datetime|time:"i" }}, {{ status.datetime|time:"s" }}), 0],
              [new Date({{ status.datetime|date:"Y" }}, {{ status.datetime|date:"m" }}, {{ status.datetime|date:"d" }}, {{ status.datetime|time:"H" }}, {{ status.datetime|time:"i" }}, {{ status.datetime|time:"s" }}), 1],
              [new Date({{ now|date:"Y" }}, {{ now|date:"m" }}, {{ now|date:"d" }}, {{ now|time:"H" }}, {{ now|time:"i" }}, {{ now|time:"s" }}), 1]
          {% else %}
              [new Date({{ now|date:"Y" }}, {{ now|date:"m" }}, {{ now|date:"d" }}, {{ now|time:"H" }}, {{ now|time:"i" }}, {{ now|time:"s" }}), 0]
          {% endif %}
        ]);

        var options = {
          width: 1200,
          height: 300,
          backgroundColor: { fill:'transparent' },
          hAxis: {
            title: '',//'Time',
            gridlines: {
              color: 'transparent',
              count: 10
            }
          },
          vAxis: {
            title: '',//'Open/Closed',
            gridlines: {
              color: 'transparent',
              count: 2
            }
          },
          colors: ['#5bba47']
        };

        var chart = new google.visualization.AreaChart(document.getElementById('chart_div'));

        chart.draw(data, options);

        $('text').filter(function () {
            return $(this).text() == '1';
        }).text("Open");
        $('text').filter(function () {
            return $(this).text() == '0';
        }).text("Closed");
    }
</script>
